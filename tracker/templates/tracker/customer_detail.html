{% extends 'tracker/base.html' %} {% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h2 class="display-6 mb-0">{{ customer.full_name }}</h2>
    <div class="text-muted small">
      {{ customer.phone }} · {{ customer.email }} · Code {{ customer.code }}
    </div>
  </div>
  <div class="d-flex gap-2">
    <a
      href="{% url 'tracker:customer_edit' customer.id %}"
      class="btn btn-outline-secondary"
      ><i class="bi bi-pencil"></i> Edit</a
    >
    <a
      href="{% url 'tracker:create_order_for_customer' customer.id %}"
      class="btn btn-primary"
      ><i class="bi bi-plus-circle"></i> New Order</a
    >
  </div>
</div>
<div class="row g-3">
  <div class="col-md-4">
    <div class="card shadow-sm">
      <div class="card-header"><strong>Profile</strong></div>
      <div class="card-body">
        <div>
          Type:
          <span class="pill pill-{{ customer.customer_type }}"
            >{{ customer.customer_type|upper }}</span
          >
        </div>
        {% if customer.organization_name %}
        <div>Org: {{ customer.organization_name }}</div>
        {% endif %} {% if customer.tax_number %}
        <div>Tax: {{ customer.tax_number }}</div>
        {% endif %} {% if customer.personal_subtype %}
        <div>Sub-type: {{ customer.personal_subtype|title }}</div>
        {% endif %}
        <div class="mt-2">
          Status:
          <span class="pill pill-{{ customer.current_status }}"
            >{{ customer.current_status|upper }}</span
          >
        </div>
        <div class="text-muted small mt-2">
          Registered {{ customer.registration_date|date:'Y-m-d H:i' }}
        </div>
      </div>
    </div>
    <div class="card shadow-sm mt-3">
      <div class="card-header"><strong>Vehicles</strong></div>
      <div class="card-body">
        {% for v in vehicles %}
        <div class="border rounded p-2 mb-2">
          {{ v.plate_number }} · {{ v.make }} {{ v.model }}
        </div>
        {% empty %}
        <div class="text-muted small">No vehicles yet.</div>
        {% endfor %}
      </div>
    </div>
  </div>
  <div class="col-md-8">
    <div class="card shadow-sm">
      <div
        class="card-header d-flex justify-content-between align-items-center"
      >
        <strong>Recent Orders</strong>
        <a
          href="{% url 'tracker:orders_list' %}"
          class="btn btn-sm btn-outline-secondary"
          >All Orders</a
        >
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table align-middle">
            <thead>
              <tr>
                <th>Order</th>
                <th>Type</th>
                <th>Status</th>
                <th>Priority</th>
                <th>Vehicle</th>
                <th>Created</th>
                <th class="text-end">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for o in orders %}
              <tr>
                <td>
                  <a href="{% url 'tracker:order_detail' o.id %}"
                    >{{ o.order_number }}</a
                  >
                </td>
                <td>{{ o.type|title }}</td>
                <td>
                  <span class="pill pill-{{ o.status }}"
                    >{{ o.status|upper }}</span
                  >
                </td>
                <td>
                  <span class="pill pill-priority-{{ o.priority }}"
                    >{{ o.priority|upper }}</span
                  >
                </td>
                <td>
                  {% if o.vehicle %}{{ o.vehicle.plate_number }}{% else %}-{%
                  endif %}
                </td>
                <td>{{ o.created_at|date:'Y-m-d H:i' }}</td>
                <td class="text-end">
                  <form
                    method="post"
                    action="{% url 'tracker:update_order_status' o.id %}"
                    class="d-inline-flex align-items-center gap-2"
                  >
                    {% csrf_token %}
                    <select
                      name="status"
                      class="form-select form-select-sm js-status-select"
                    >
                      {% for val,label in o.STATUS_CHOICES %}
                      <option
                        value="{{ val }}"
                        {%
                        if
                        o.status=""
                        ="val"
                        %}selected{%
                        endif
                        %}
                      >
                        {{ label }}
                      </option>
                      {% endfor %}
                    </select>
                    <button class="btn btn-sm btn-primary">Update</button>
                  </form>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="7" class="text-center text-muted">No orders.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
