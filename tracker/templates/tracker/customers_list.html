{% extends 'tracker/base.html' %} {% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="display-6 m-0">Customers</h2>
  <div class="d-flex gap-2">
    <form class="d-flex gap-2" method="get">
      <input
        class="form-control"
        name="q"
        value="{{ q }}"
        placeholder="Search name or phone"
      />
      <button class="btn btn-outline-secondary">Search</button>
    </form>
    <a
      class="btn btn-outline-secondary"
      href="{% url 'tracker:customers_export' %}?{{ request.GET.urlencode }}"
      ><i class="bi bi-download"></i> Export</a
    >
    <a href="{% url 'tracker:customer_register' %}" class="btn btn-primary"
      ><i class="bi bi-person-plus"></i> Register</a
    >
  </div>
</div>
<div class="card shadow-sm">
  <div class="card-body table-responsive">
    <table class="table align-middle">
      <thead>
        <tr>
          <th>Code</th>
          <th>Name</th>
          <th>Phone</th>
          <th>Type</th>
          <th>Visits</th>
          <th>Last Visit</th>
          <th>Status</th>
          <th class="text-end">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for c in customers %}
        <tr>
          <td class="text-muted small">{{ c.code }}</td>
          <td class="fw-semibold">{{ c.full_name }}</td>
          <td>{{ c.phone }}</td>
          <td>
            <span class="pill pill-{{ c.customer_type }}"
              >{{ c.customer_type|upper }}</span
            >
          </td>
          <td>{{ c.total_visits }}</td>
          <td>{{ c.last_visit|date:'Y-m-d H:i' }}</td>
          <td>
            <span class="pill pill-{{ c.current_status }}"
              >{{ c.current_status|upper }}</span
            >
          </td>
          <td class="text-end">
            <a
              class="btn btn-sm btn-outline-secondary"
              href="{% url 'tracker:customer_detail' c.id %}"
              ><i class="bi bi-box-arrow-in-right"></i> View</a
            >
            <a
              class="btn btn-sm btn-outline-primary"
              href="{% url 'tracker:customer_edit' c.id %}"
              ><i class="bi bi-pencil"></i> Edit</a
            >
            <a
              class="btn btn-sm btn-success"
              href="{% url 'tracker:create_order_for_customer' c.id %}"
              ><i class="bi bi-plus-circle"></i> New Order</a
            >
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="8" class="text-muted">No customers found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% if customers.paginator %}
    <nav class="d-flex justify-content-between align-items-center">
      <div class="small text-muted">
        Page {{ customers.number }} of {{ customers.paginator.num_pages }}
      </div>
      <ul class="pagination m-0">
        {% if customers.has_previous %}
        <li class="page-item">
          <a
            class="page-link"
            href="?q={{ q }}&page={{ customers.previous_page_number }}"
            >Prev</a
          >
        </li>
        {% else %}
        <li class="page-item disabled"><span class="page-link">Prev</span></li>
        {% endif %} {% if customers.has_next %}
        <li class="page-item">
          <a
            class="page-link"
            href="?q={{ q }}&page={{ customers.next_page_number }}"
            >Next</a
          >
        </li>
        {% else %}
        <li class="page-item disabled"><span class="page-link">Next</span></li>
        {% endif %}
      </ul>
    </nav>
    {% endif %}
  </div>
</div>
{% endblock %}
